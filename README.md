<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù†Ø¸ÙˆÙ…Ø© Ù…Ø¨ÙŠØ¹Ø§Øª Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø´Ø±ÙˆÙ‚ - Ø§Ù„Ø¥ØµØ¯Ø§Ø± 2026 Pro</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            direction: rtl;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #1a1a1a;
            font-size: 12px;
            min-height: 100vh;
        }

        /* Modern Delphi Style */
        .modern-form {
            background: linear-gradient(180deg, #f8f9fa 0%, #e9ecef 100%);
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 2px;
            margin: 5px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .modern-panel {
            background: #fff;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 8px;
            margin: 6px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        .modern-button {
            background: linear-gradient(180deg, #0d6efd 0%, #0956ca 100%);
            border: 1px solid #0d6efd;
            border-radius: 5px;
            padding: 8px 16px;
            font-family: 'Segoe UI', sans-serif;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            color: #fff;
            text-align: center;
            margin: 4px;
            transition: all 0.2s;
            box-shadow: 0 2px 4px rgba(13, 110, 253, 0.2);
        }

        .modern-button:hover {
            background: linear-gradient(180deg, #0860ca 0%, #074399 100%);
            box-shadow: 0 4px 8px rgba(13, 110, 253, 0.3);
            transform: translateY(-1px);
        }

        .modern-button:active {
            transform: translateY(0);
            box-shadow: 0 1px 2px rgba(13, 110, 253, 0.2);
        }

        .modern-input {
            background-color: #fff;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 8px 12px;
            font-family: 'Segoe UI', sans-serif;
            font-size: 12px;
            color: #495057;
            margin: 4px 0;
            transition: border-color 0.2s;
        }

        .modern-input:focus {
            outline: none;
            border-color: #0d6efd;
            box-shadow: 0 0 0 3px rgba(13, 110, 253, 0.1);
        }

        .modern-select {
            background-color: #fff;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 8px 12px;
            font-family: 'Segoe UI', sans-serif;
            font-size: 12px;
            color: #495057;
            margin: 4px 0;
            cursor: pointer;
            transition: border-color 0.2s;
        }

        .modern-select:focus {
            outline: none;
            border-color: #0d6efd;
            box-shadow: 0 0 0 3px rgba(13, 110, 253, 0.1);
        }

        .modern-label {
            background-color: transparent;
            font-size: 12px;
            padding: 4px;
            color: #495057;
            font-weight: 500;
        }

        .modern-groupbox {
            background: #fff;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 12px;
            margin: 8px;
            position: relative;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        .modern-groupbox-title {
            position: absolute;
            top: -10px;
            right: 12px;
            background: linear-gradient(180deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 0 8px;
            font-weight: 600;
            font-size: 12px;
            color: #0d6efd;
        }

        .modern-grid {
            border: 1px solid #dee2e6;
            background-color: #fff;
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
            margin: 6px 0;
            border-radius: 4px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        .modern-grid th {
            background: linear-gradient(180deg, #f8f9fa 0%, #e9ecef 100%);
            border: 1px solid #dee2e6;
            padding: 8px;
            text-align: right;
            font-weight: 600;
            color: #0d6efd;
        }

        .modern-grid td {
            border: 1px solid #e9ecef;
            padding: 8px;
            text-align: right;
        }

        .modern-grid tr:hover {
            background-color: #f8f9fa;
        }

        .modern-window {
            background: #fff;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
            position: fixed;
            z-index: 1000;
            min-width: 400px;
            max-width: 90vw;
            max-height: 90vh;
            display: none;
        }

        .modern-window.show {
            display: block;
        }

        .modern-window-caption {
            background: linear-gradient(90deg, #0d6efd 0%, #0860ca 100%);
            color: #fff;
            padding: 12px;
            font-weight: 600;
            font-size: 13px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            user-select: none;
            cursor: move;
            border-radius: 8px 8px 0 0;
        }

        .modern-window-close {
            width: 28px;
            height: 28px;
            background: rgba(255,255,255,0.2);
            border: none;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 16px;
            color: #fff;
            transition: all 0.2s;
        }

        .modern-window-close:hover {
            background: rgba(255,255,255,0.3);
        }

        .modern-window-content {
            padding: 12px;
            overflow-y: auto;
            max-height: calc(90vh - 50px);
        }

        .modern-statusbar {
            background: linear-gradient(180deg, #f8f9fa 0%, #e9ecef 100%);
            border-top: 1px solid #dee2e6;
            padding: 8px;
            display: flex;
            font-size: 11px;
            position: fixed;
            bottom: 0;
            width: 100%;
            height: 24px;
            align-items: center;
            box-shadow: 0 -2px 8px rgba(0,0,0,0.05);
        }

        .modern-statusbar-panel {
            padding: 4px 8px;
            border-right: 1px solid #dee2e6;
            flex: 1;
            color: #495057;
        }

        /* Main Layout */
        .main-container {
            display: flex;
            height: 100vh;
            flex-direction: column;
        }

        .menu-bar {
            background: linear-gradient(180deg, #f8f9fa 0%, #e9ecef 100%);
            border-bottom: 1px solid #dee2e6;
            padding: 6px;
            display: flex;
            gap: 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .menu-item {
            padding: 6px 12px;
            cursor: pointer;
            user-select: none;
            position: relative;
            color: #495057;
            font-weight: 500;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .menu-item:hover {
            background: #0d6efd;
            color: #fff;
        }

        .submenu {
            position: absolute;
            background: #fff;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            display: none;
            min-width: 160px;
            top: 100%;
            right: 0;
            z-index: 100;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-top: 4px;
        }

        .submenu.show {
            display: block;
        }

        .submenu-item {
            padding: 8px 16px;
            cursor: pointer;
            user-select: none;
            border-bottom: 1px solid #f0f0f0;
            color: #495057;
            transition: all 0.2s;
        }

        .submenu-item:last-child {
            border-bottom: none;
        }

        .submenu-item:hover {
            background: #f8f9fa;
            color: #0d6efd;
            padding-right: 20px;
        }

        .content-area {
            flex: 1;
            overflow: auto;
            margin-bottom: 24px;
            padding: 10px;
        }

        .form-row {
            display: flex;
            gap: 12px;
            margin: 6px 0;
            align-items: center;
        }

        .form-label {
            width: 140px;
            text-align: right;
            font-weight: 500;
            color: #495057;
        }

        .form-control {
            flex: 1;
            min-width: 200px;
        }

        .button-group {
            display: flex;
            gap: 8px;
            margin: 8px 0;
            justify-content: center;
            flex-wrap: wrap;
        }

        .toolbar {
            background: linear-gradient(180deg, #f8f9fa 0%, #e9ecef 100%);
            border-bottom: 1px solid #dee2e6;
            padding: 8px;
            display: flex;
            gap: 8px;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            flex-wrap: wrap;
        }

        .toolbar-separator {
            width: 1px;
            height: 22px;
            background-color: #dee2e6;
            margin: 0 4px;
        }

        .input-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin: 8px;
        }

        .message-box {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #fff;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 0;
            z-index: 2000;
            min-width: 300px;
            max-width: 500px;
            display: none;
            box-shadow: 0 20px 60px rgba(0,0,0,0.2);
        }

        .message-box.show {
            display: block;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        .message-box-title {
            background: linear-gradient(90deg, #0d6efd 0%, #0860ca 100%);
            color: #fff;
            padding: 12px;
            font-weight: 600;
            border-radius: 8px 8px 0 0;
        }

        .message-box-content {
            padding: 16px;
            text-align: center;
            margin-bottom: 8px;
            color: #495057;
        }

        .message-box-buttons {
            display: flex;
            gap: 8px;
            justify-content: center;
            padding: 8px 16px 16px;
        }

        /* Specific Styles */
        .scanner-input-area {
            background-color: #fff;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 12px;
            margin: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        .invoice-summary {
            background: linear-gradient(180deg, #f8f9fa 0%, #e9ecef 100%);
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 12px;
            margin: 8px;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            padding: 6px;
            border-bottom: 1px solid #dee2e6;
            color: #495057;
        }

        .summary-row.total {
            font-weight: 600;
            border: 2px solid #0d6efd;
            border-radius: 4px;
            padding: 8px;
            margin: 4px 0;
            background: #fff;
            color: #0d6efd;
        }

        .hidden {
            display: none !important;
        }

        /* Keyboard shortcut hint */
        .shortcut-hint {
            font-size: 10px;
            color: #868e96;
            margin-top: 2px;
        }

        /* Success/Error colors */
        .success { color: #198754; }
        .error { color: #dc3545; }
        .warning { color: #ffc107; }
        .info { color: #0d6efd; }
    </style>
</head>
<body>
    <div class="main-container">
        <!-- Menu Bar -->
        <div class="menu-bar">
            <div class="menu-item">
                Ù…Ù„Ù
                <div class="submenu">
                    <div class="submenu-item" onclick="newInvoice()" title="F1">ÙØ§ØªÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø© <span class="shortcut-hint">(F1)</span></div>
                    <div class="submenu-item" onclick="openFile()" title="F2">ÙØªØ­ Ù…Ù„Ù <span class="shortcut-hint">(F2)</span></div>
                    <div class="submenu-item" onclick="saveFile()" title="F3">Ø­ÙØ¸ <span class="shortcut-hint">(F3)</span></div>
                    <div class="submenu-item" onclick="exportBackup()">Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</div>
                    <div class="submenu-item" onclick="importBackup()">Ø§Ø³ØªÙŠØ±Ø§Ø¯</div>
                    <div class="submenu-item" style="border-top: 1px solid #dee2e6; margin-top: 4px;" onclick="exitApp()">Ø®Ø±ÙˆØ¬</div>
                </div>
            </div>
            <div class="menu-item">
                ØªØ­Ø±ÙŠØ±
                <div class="submenu">
                    <div class="submenu-item" onclick="undo()">ØªØ±Ø§Ø¬Ø¹</div>
                    <div class="submenu-item" onclick="redo()">Ø¥Ø¹Ø§Ø¯Ø©</div>
                </div>
            </div>
            <div class="menu-item">
                Ø¨ÙŠØ§Ù†Ø§Øª
                <div class="submenu">
                    <div class="submenu-item" onclick="showProductsForm()" title="F4">Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ØµÙ†Ù <span class="shortcut-hint">(F4)</span></div>
                    <div class="submenu-item" onclick="showCustomersForm()" title="F5">Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„ <span class="shortcut-hint">(F5)</span></div>
                    <div class="submenu-item" onclick="showEmployeesForm()" title="F6">Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…ÙˆØ¸Ù <span class="shortcut-hint">(F6)</span></div>
                    <div class="submenu-item" onclick="showSuppliersForm()">Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…ÙˆØ±Ø¯</div>
                </div>
            </div>
            <div class="menu-item">
                Ø¹Ù…Ù„ÙŠØ§Øª
                <div class="submenu">
                    <div class="submenu-item" onclick="showPointOfSale()" title="F7">Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹ <span class="shortcut-hint">(F7)</span></div>
                    <div class="submenu-item" onclick="showReturns()" title="F8">Ù†Ù‚Ø·Ø© Ø§Ù„ØªØ±Ø¬ÙŠØ¹ <span class="shortcut-hint">(F8)</span></div>
                    <div class="submenu-item" onclick="showWholesale()" title="F9">Ø§Ù„Ø¨ÙŠØ¹ Ø¨Ø§Ù„Ø¬Ù…Ù„Ø© <span class="shortcut-hint">(F9)</span></div>
                    <div class="submenu-item" onclick="showPurchases()">Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª ÙˆØ§Ù„ÙˆØ§Ø±Ø¯</div>
                    <div class="submenu-item" onclick="showExpenses()">Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</div>
                </div>
            </div>
            <div class="menu-item">
                ØªÙ‚Ø§Ø±ÙŠØ±
                <div class="submenu">
                    <div class="submenu-item" onclick="showSalesReport()" title="F10">ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª <span class="shortcut-hint">(F10)</span></div>
                    <div class="submenu-item" onclick="showGeneralReport()">Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¹Ø§Ù…</div>
                    <div class="submenu-item" onclick="showInventoryReport()">ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</div>
                    <div class="submenu-item" onclick="showExpensesReport()">ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</div>
                </div>
            </div>
            <div class="menu-item">
                Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
                <div class="submenu">
                    <div class="submenu-item" onclick="showSettings()" title="F11">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª <span class="shortcut-hint">(F11)</span></div>
                    <div class="submenu-item" onclick="showUsersForm()" title="F12">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† <span class="shortcut-hint">(F12)</span></div>
                    <div class="submenu-item" onclick="showAbout()">Ø¹Ù† Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬</div>
                </div>
            </div>
        </div>

        <!-- Toolbar -->
        <div class="toolbar">
            <button class="modern-button" title="ÙØ§ØªÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø© (F1)" onclick="newInvoice()">ğŸ“„ Ø¬Ø¯ÙŠØ¯</button>
            <button class="modern-button" title="Ø­ÙØ¸ (F3)" onclick="saveFile()">ğŸ’¾ Ø­ÙØ¸</button>
            <button class="modern-button" title="ÙØªØ­ (F2)" onclick="openFile()">ğŸ“‚ ÙØªØ­</button>
            <div class="toolbar-separator"></div>
            <button class="modern-button" title="Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹ (F7)" onclick="showPointOfSale()">ğŸ›’ Ø¨ÙŠØ¹</button>
            <button class="modern-button" title="ØªØ±Ø¬ÙŠØ¹ (F8)" onclick="showReturns()">â†©ï¸ ØªØ±Ø¬ÙŠØ¹</button>
            <button class="modern-button" title="Ø¬Ù…Ù„Ø© (F9)" onclick="showWholesale()">ğŸ“¦ Ø¬Ù…Ù„Ø©</button>
            <div class="toolbar-separator"></div>
            <button class="modern-button" title="ØªÙ‚Ø§Ø±ÙŠØ± (F10)" onclick="showGeneralReport()">ğŸ“Š ØªÙ‚Ø§Ø±ÙŠØ±</button>
            <button class="modern-button" title="Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª (F11)" onclick="showSettings()">âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
        </div>

        <!-- Content Area -->
        <div class="content-area" id="contentArea">
            <!-- Point of Sale Form -->
            <div id="posForm" class="modern-form hidden">
                <div style="padding: 6px;">
                    <div style="font-weight: 600; margin-bottom: 12px; font-size: 14px; color: #0d6efd;">ğŸ›’ Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹</div>
                    
                    <div class="modern-groupbox" style="margin-top: 20px;">
                        <div class="modern-groupbox-title">Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</div>
                        <div class="scanner-input-area">
                            <div class="form-row">
                                <label class="form-label">ÙƒÙˆØ¯ Ø§Ù„ØµÙ†Ù/Ø§Ù„Ù…Ø§Ø³Ø­:</label>
                                <input type="text" id="scannerInput" class="modern-input form-control" placeholder="Ø§Ù…Ø³Ø­ Ø§Ù„ÙƒÙˆØ¯ Ù‡Ù†Ø§..." autofocus>
                            </div>
                        </div>
                    </div>

                    <div class="modern-groupbox">
                        <div class="modern-groupbox-title">Ø¨Ù†ÙˆØ¯ Ø§Ù„ÙØ§ØªÙˆØ±Ø©</div>
                        <div style="overflow-x: auto;">
                            <table class="modern-grid" id="invoiceGrid">
                                <thead>
                                    <tr>
                                        <th style="width: 25%;">Ø§Ù„ØµÙ†Ù</th>
                                        <th style="width: 15%;">Ø§Ù„ÙƒÙˆØ¯</th>
                                        <th style="width: 12%;">Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                                        <th style="width: 12%;">Ø§Ù„Ø³Ø¹Ø±</th>
                                        <th style="width: 15%;">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</th>
                                        <th style="width: 10%;">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                        <th style="width: 11%;">ØªØ¹Ø¯ÙŠÙ„</th>
                                    </tr>
                                </thead>
                                <tbody id="invoiceBody">
                                    <tr><td colspan="7" style="text-align: center; padding: 8px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div style="display: flex; gap: 12px; margin: 12px;">
                        <!-- Left Side - Summary -->
                        <div style="flex: 1;">
                            <div class="invoice-summary">
                                <div style="font-weight: 600; margin-bottom: 8px; text-align: center; color: #0d6efd;">Ù…Ù„Ø®Øµ Ø§Ù„ÙØ§ØªÙˆØ±Ø©</div>
                                <div class="summary-row">
                                    <span>Ø¹Ø¯Ø¯ Ø§Ù„Ø¨Ù†ÙˆØ¯:</span>
                                    <span id="itemCount" style="font-weight: 600;">0</span>
                                </div>
                                <div class="summary-row">
                                    <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù‚Ø¨Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©:</span>
                                    <span id="subtotal" style="font-weight: 600;">0.00</span>
                                </div>
                                <div class="summary-row">
                                    <span>Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© (15%):</span>
                                    <span id="taxAmount" style="font-weight: 600;">0.00</span>
                                </div>
                                <div class="summary-row total">
                                    <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:</span>
                                    <span id="totalAmount" style="color: #dc3545;">0.00</span>
                                </div>
                            </div>
                        </div>

                        <!-- Right Side - Payment -->
                        <div style="flex: 1;">
                            <div class="modern-groupbox">
                                <div class="modern-groupbox-title">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</div>
                                <div class="form-row">
                                    <label class="form-label">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹:</label>
                                    <select id="paymentMethod" class="modern-select form-control">
                                        <option value="cash">ğŸ’µ Ù†Ù‚Ø¯Ø§Ù‹</option>
                                        <option value="card">ğŸ’³ Ø¨Ø·Ø§Ù‚Ø© Ø§Ø¦ØªÙ…Ø§Ù†</option>
                                        <option value="check">âœ“ Ø´ÙŠÙƒ</option>
                                        <option value="credit">ğŸ“‹ Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø³Ø§Ø¨</option>
                                    </select>
                                </div>
                                <div class="form-row">
                                    <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„:</label>
                                    <input type="text" id="customerName" class="modern-input form-control" placeholder="Ø§Ø®ØªÙŠØ§Ø±ÙŠ">
                                </div>
                                <div class="form-row">
                                    <label class="form-label">Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</label>
                                    <textarea id="invoiceNotes" class="modern-input form-control" style="height: 50px; resize: vertical;"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Buttons -->
                    <div class="modern-groupbox">
                        <div class="button-group" style="justify-content: flex-start;">
                            <button class="modern-button" style="min-width: 120px;" onclick="completeInvoice()">âœ… Ø¥ØªÙ…Ø§Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©</button>
                            <button class="modern-button" style="min-width: 120px;" onclick="togglePendingInvoices()">â±ï¸ ÙÙˆØ§ØªÙŠØ± Ù…Ø¹Ù„Ù‚Ø©</button>
                            <button class="modern-button" style="min-width: 100px;" onclick="printInvoice()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
                            <button class="modern-button" style="min-width: 100px;" onclick="clearInvoice()">ğŸ—‘ï¸ Ù…Ø³Ø­</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Products Form -->
            <div id="productsForm" class="modern-form hidden">
                <div style="padding: 6px;">
                    <div style="font-weight: 600; margin-bottom: 12px; font-size: 14px; color: #0d6efd;">ğŸ“¦ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ØµÙ†Ù</div>
                    
                    <div class="modern-groupbox">
                        <div class="modern-groupbox-title">Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù Ø¬Ø¯ÙŠØ¯</div>
                        <div class="input-group">
                            <div>
                                <div class="modern-label">ÙƒÙˆØ¯ Ø§Ù„ØµÙ†Ù:</div>
                                <input type="text" id="productCode" class="modern-input" style="width: 100%;">
                            </div>
                            <div>
                                <div class="modern-label">Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù:</div>
                                <input type="text" id="productName" class="modern-input" style="width: 100%;">
                            </div>
                            <div>
                                <div class="modern-label">Ø§Ù„ÙØ¦Ø©:</div>
                                <select id="productCategory" class="modern-select" style="width: 100%;">
                                    <option>Ø§Ø®ØªØ± Ø§Ù„ÙØ¦Ø©</option>
                                    <option>Ø£Ù‚Ù„Ø§Ù…</option>
                                    <option>Ø¯ÙØ§ØªØ±</option>
                                    <option>Ø£ÙˆØ±Ø§Ù‚</option>
                                    <option>Ø£Ø¯ÙˆØ§Øª Ø±Ø³Ù…</option>
                                    <option>Ø£Ø®Ø±Ù‰</option>
                                </select>
                            </div>
                            <div>
                                <div class="modern-label">Ø§Ù„Ø³Ø¹Ø±:</div>
                                <input type="number" id="productPrice" class="modern-input" step="0.01" style="width: 100%;">
                            </div>
                            <div>
                                <div class="modern-label">Ø§Ù„ÙƒÙ…ÙŠØ©:</div>
                                <input type="number" id="productQuantity" class="modern-input" min="0" style="width: 100%;">
                            </div>
                            <div>
                                <div class="modern-label">Ø§Ù„Ù…ÙˆØ±Ø¯:</div>
                                <input type="text" id="productSupplier" class="modern-input" style="width: 100%;">
                            </div>
                        </div>
                        <div class="button-group" style="justify-content: flex-start; margin-top: 12px;">
                            <button class="modern-button" onclick="addProduct()">â• Ø¥Ø¶Ø§ÙØ©</button>
                            <button class="modern-button" onclick="updateProduct()">âœï¸ ØªØ­Ø¯ÙŠØ«</button>
                            <button class="modern-button" onclick="clearProductForm()">ğŸ—‘ï¸ Ù…Ø³Ø­</button>
                        </div>
                    </div>

                    <div class="modern-groupbox">
                        <div class="modern-groupbox-title">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ØµÙ†Ø§Ù</div>
                        <div style="overflow-x: auto;">
                            <table class="modern-grid" id="productsGrid">
                                <thead>
                                    <tr>
                                        <th style="width: 15%;">Ø§Ù„ÙƒÙˆØ¯</th>
                                        <th style="width: 25%;">Ø§Ù„Ø§Ø³Ù…</th>
                                        <th style="width: 15%;">Ø§Ù„ÙØ¦Ø©</th>
                                        <th style="width: 12%;">Ø§Ù„Ø³Ø¹Ø±</th>
                                        <th style="width: 10%;">Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</th>
                                        <th style="width: 15%;">Ø§Ù„Ù…ÙˆØ±Ø¯</th>
                                        <th style="width: 8%;">Ø­Ø°Ù</th>
                                    </tr>
                                </thead>
                                <tbody id="productsBody">
                                    <tr><td colspan="7" style="text-align: center; padding: 8px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Customers Form -->
            <div id="customersForm" class="modern-form hidden">
                <div style="padding: 6px;">
                    <div style="font-weight: 600; margin-bottom: 12px; font-size: 14px; color: #0d6efd;">ğŸ‘¥ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„</div>
                    
                    <div class="modern-groupbox">
                        <div class="modern-groupbox-title">Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯</div>
                        <div class="input-group">
                            <div>
                                <div class="modern-label">Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„:</div>
                                <input type="text" id="customerCode" class="modern-input" style="width: 100%;">
                            </div>
                            <div>
                                <div class="modern-label">Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„:</div>
                                <input type="text" id="customerNameInput" class="modern-input" style="width: 100%;">
                            </div>
                            <div>
                                <div class="modern-label">Ø§Ù„Ù†ÙˆØ¹:</div>
                                <select id="customerType" class="modern-select" style="width: 100%;">
                                    <option value="retail">ØªØ¬Ø²Ø¦Ø©</option>
                                    <option value="wholesale">Ø¬Ù…Ù„Ø©</option>
                                    <option value="corporate">Ø´Ø±ÙƒØ©</option>
                                </select>
                            </div>
                            <div>
                                <div class="modern-label">Ø§Ù„Ù‡Ø§ØªÙ:</div>
                                <input type="tel" id="customerPhone" class="modern-input" style="width: 100%;">
                            </div>
                            <div>
                                <div class="modern-label">Ø§Ù„Ø¨Ø±ÙŠØ¯:</div>
                                <input type="email" id="customerEmail" class="modern-input" style="width: 100%;">
                            </div>
                            <div>
                                <div class="modern-label">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</div>
                                <input type="text" id="customerAddress" class="modern-input" style="width: 100%;">
                            </div>
                        </div>
                        <div class="button-group" style="justify-content: flex-start; margin-top: 12px;">
                            <button class="modern-button" onclick="addCustomer()">â• Ø¥Ø¶Ø§ÙØ©</button>
                            <button class="modern-button" onclick="clearCustomerForm()">ğŸ—‘ï¸ Ù…Ø³Ø­</button>
                        </div>
                    </div>

                    <div class="modern-groupbox">
                        <div class="modern-groupbox-title">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</div>
                        <div style="overflow-x: auto;">
                            <table class="modern-grid" id="customersGrid">
                                <thead>
                                    <tr>
                                        <th style="width: 15%;">Ø§Ù„Ø±Ù‚Ù…</th>
                                        <th style="width: 25%;">Ø§Ù„Ø§Ø³Ù…</th>
                                        <th style="width: 15%;">Ø§Ù„Ù†ÙˆØ¹</th>
                                        <th style="width: 15%;">Ø§Ù„Ù‡Ø§ØªÙ</th>
                                        <th style="width: 15%;">Ø§Ù„Ø±ØµÙŠØ¯</th>
                                        <th style="width: 10%;">Ø­Ø°Ù</th>
                                    </tr>
                                </thead>
                                <tbody id="customersBody">
                                    <tr><td colspan="6" style="text-align: center; padding: 8px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù…Ù„Ø§Ø¡</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Employees Form -->
            <div id="employeesForm" class="modern-form hidden">
                <div style="padding: 6px;">
                    <div style="font-weight: 600; margin-bottom: 12px; font-size: 14px; color: #0d6efd;">ğŸ‘” Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…ÙˆØ¸Ù</div>
                    
                    <div class="modern-groupbox">
                        <div class="modern-groupbox-title">Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù Ø¬Ø¯ÙŠØ¯</div>
                        <div class="input-group">
                            <div>
                                <div class="modern-label">Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¸Ù:</div>
                                <input type="text" id="employeeCode" class="modern-input" style="width: 100%;">
                            </div>
                            <div>
                                <div class="modern-label">Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù:</div>
                                <input type="text" id="employeeName" class="modern-input" style="width: 100%;">
                            </div>
                            <div>
                                <div class="modern-label">Ø§Ù„Ù…Ù†ØµØ¨:</div>
                                <input type="text" id="employeePosition" class="modern-input" style="width: 100%;">
                            </div>
                            <div>
                                <div class="modern-label">Ø§Ù„Ø±Ø§ØªØ¨:</div>
                                <input type="number" id="employeeSalary" class="modern-input" step="0.01" style="width: 100%;">
                            </div>
                            <div>
                                <div class="modern-label">Ø§Ù„Ù‡Ø§ØªÙ:</div>
                                <input type="tel" id="employeePhone" class="modern-input" style="width: 100%;">
                            </div>
                            <div>
                                <div class="modern-label">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¹ÙŠÙŠÙ†:</div>
                                <input type="date" id="employeeStartDate" class="modern-input" style="width: 100%;">
                            </div>
                        </div>
                        <div class="button-group" style="justify-content: flex-start; margin-top: 12px;">
                            <button class="modern-button" onclick="addEmployee()">â• Ø¥Ø¶Ø§ÙØ©</button>
                            <button class="modern-button" onclick="clearEmployeeForm()">ğŸ—‘ï¸ Ù…Ø³Ø­</button>
                        </div>
                    </div>

                    <div class="modern-groupbox">
                        <div class="modern-groupbox-title">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</div>
                        <div style="overflow-x: auto;">
                            <table class="modern-grid" id="employeesGrid">
                                <thead>
                                    <tr>
                                        <th style="width: 15%;">Ø§Ù„Ø±Ù‚Ù…</th>
                                        <th style="width: 25%;">Ø§Ù„Ø§Ø³Ù…</th>
                                        <th style="width: 15%;">Ø§Ù„Ù…Ù†ØµØ¨</th>
                                        <th style="width: 12%;">Ø§Ù„Ø±Ø§ØªØ¨</th>
                                        <th style="width: 18%;">Ø§Ù„ØªØ¹ÙŠÙŠÙ†</th>
                                        <th style="width: 10%;">Ø­Ø°Ù</th>
                                    </tr>
                                </thead>
                                <tbody id="employeesBody">
                                    <tr><td colspan="6" style="text-align: center; padding: 8px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ¸ÙÙŠÙ†</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Returns Form -->
            <div id="returnsForm" class="modern-form hidden">
                <div style="padding: 6px;">
                    <div style="font-weight: 600; margin-bottom: 12px; font-size: 14px; color: #0d6efd;">â†©ï¸ Ù†Ù‚Ø·Ø© Ø§Ù„ØªØ±Ø¬ÙŠØ¹</div>
                    
                    <div class="modern-groupbox">
                        <div class="modern-groupbox-title">Ø¥Ø¶Ø§ÙØ© ØªØ±Ø¬ÙŠØ¹</div>
                        <div class="input-group">
                            <div>
                                <div class="modern-label">Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©:</div>
                                <input type="text" id="returnCode" class="modern-input" style="width: 100%;">
                            </div>
                            <div>
                                <div class="modern-label">Ø§Ù„ØµÙ†Ù:</div>
                                <input type="text" id="returnProduct" class="modern-input" style="width: 100%;">
                            </div>
                            <div>
                                <div class="modern-label">Ø§Ù„ÙƒÙ…ÙŠØ©:</div>
                                <input type="number" id="returnQuantity" class="modern-input" min="1" style="width: 100%;">
                            </div>
                            <div>
                                <div class="modern-label">Ø§Ù„Ø³Ø¨Ø¨:</div>
                                <textarea id="returnReason" class="modern-input" style="width: 100%; height: 50px;"></textarea>
                            </div>
                        </div>
                        <div class="button-group" style="justify-content: flex-start; margin-top: 12px;">
                            <button class="modern-button" onclick="addReturn()">â• Ø¥Ø¶Ø§ÙØ©</button>
                            <button class="modern-button" onclick="clearReturnForm()">ğŸ—‘ï¸ Ù…Ø³Ø­</button>
                        </div>
                    </div>

                    <div class="modern-groupbox">
                        <div class="modern-groupbox-title">Ø³Ø¬Ù„ Ø§Ù„ØªØ±Ø¬ÙŠØ¹Ø§Øª</div>
                        <div style="overflow-x: auto;">
                            <table class="modern-grid" id="returnsGrid">
                                <thead>
                                    <tr>
                                        <th style="width: 15%;">Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©</th>
                                        <th style="width: 25%;">Ø§Ù„ØµÙ†Ù</th>
                                        <th style="width: 10%;">Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                                        <th style="width: 25%;">Ø§Ù„Ø³Ø¨Ø¨</th>
                                        <th style="width: 15%;">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                        <th style="width: 10%;">Ø­Ø°Ù</th>
                                    </tr>
                                </thead>
                                <tbody id="returnsBody">
                                    <tr><td colspan="6" style="text-align: center; padding: 8px;">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ±Ø¬ÙŠØ¹Ø§Øª</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Wholesale Form -->
            <div id="wholesaleForm" class="modern-form hidden">
                <div style="padding: 6px;">
                    <div style="font-weight: 600; margin-bottom: 12px; font-size: 14px; color: #0d6efd;">ğŸ“¦ Ø§Ù„Ø¨ÙŠØ¹ Ø¨Ø§Ù„Ø¬Ù…Ù„Ø©</div>
                    
                    <div class="modern-groupbox">
                        <div class="modern-groupbox-title">Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ Ø¬Ù…Ù„Ø©</div>
                        <div class="input-group">
                            <div>
                                <div class="modern-label">Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„:</div>
                                <input type="text" id="wholesaleCustomer" class="modern-input" style="width: 100%;">
                            </div>
                            <div>
                                <div class="modern-label">Ø§Ù„ØµÙ†Ù:</div>
                                <input type="text" id="wholesaleProduct" class="modern-input" style="width: 100%;">
                            </div>
                            <div>
                                <div class="modern-label">Ø§Ù„ÙƒÙ…ÙŠØ©:</div>
                                <input type="number" id="wholesaleQuantity" class="modern-input" min="1" style="width: 100%;">
                            </div>
                            <div>
                                <div class="modern-label">Ø§Ù„Ø®ØµÙ… (%):</div>
                                <input type="number" id="wholesaleDiscount" class="modern-input" min="0" max="100" style="width: 100%;">
                            </div>
                        </div>
                        <div class="button-group" style="justify-content: flex-start; margin-top: 12px;">
                            <button class="modern-button" onclick="addWholesale()">â• Ø¥Ù†Ø´Ø§Ø¡</button>
                            <button class="modern-button" onclick="clearWholesaleForm()">ğŸ—‘ï¸ Ù…Ø³Ø­</button>
                        </div>
                    </div>

                    <div class="modern-groupbox">
                        <div class="modern-groupbox-title">Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¬Ù…Ù„Ø©</div>
                        <div style="overflow-x: auto;">
                            <table class="modern-grid" id="wholesaleGrid">
                                <thead>
                                    <tr>
                                        <th style="width: 20%;">Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
                                        <th style="width: 25%;">Ø§Ù„ØµÙ†Ù</th>
                                        <th style="width: 10%;">Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                                        <th style="width: 10%;">Ø§Ù„Ø®ØµÙ…</th>
                                        <th style="width: 15%;">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
                                        <th style="width: 12%;">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                        <th style="width: 8%;">Ø­Ø°Ù</th>
                                    </tr>
                                </thead>
                                <tbody id="wholesaleBody">
                                    <tr><td colspan="7" style="text-align: center; padding: 8px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Reports Form -->
            <div id="reportsForm" class="modern-form hidden">
                <div style="padding: 6px;">
                    <div style="font-weight: 600; margin-bottom: 12px; font-size: 14px; color: #0d6efd;">ğŸ“Š Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</div>
                    
                    <div class="modern-groupbox">
                        <div class="modern-groupbox-title">Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¹Ø§Ù…</div>
                        <div style="display: flex; gap: 16px; margin: 8px 0;">
                            <div style="flex: 1; background: linear-gradient(135deg, #e7f3ff 0%, #fff 100%); border: 1px solid #dee2e6; border-radius: 6px; padding: 12px; text-align: center;">
                                <div style="font-weight: 600; font-size: 12px; color: #0d6efd;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</div>
                                <div style="font-size: 20px; font-weight: 700; color: #0d6efd; margin-top: 6px;" id="totalSales">0.00</div>
                            </div>
                            <div style="flex: 1; background: linear-gradient(135deg, #fff3e0 0%, #fff 100%); border: 1px solid #dee2e6; border-radius: 6px; padding: 12px; text-align: center;">
                                <div style="font-weight: 600; font-size: 12px; color: #fd7e14;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</div>
                                <div style="font-size: 20px; font-weight: 700; color: #fd7e14; margin-top: 6px;" id="totalExpenses">0.00</div>
                            </div>
                            <div style="flex: 1; background: linear-gradient(135deg, #e8f5e9 0%, #fff 100%); border: 1px solid #dee2e6; border-radius: 6px; padding: 12px; text-align: center;">
                                <div style="font-weight: 600; font-size: 12px; color: #198754;">ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­</div>
                                <div style="font-size: 20px; font-weight: 700; color: #198754; margin-top: 6px;" id="netProfit">0.00</div>
                            </div>
                        </div>
                    </div>

                    <div class="modern-groupbox">
                        <div class="modern-groupbox-title">ÙƒØ´Ù Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</div>
                        <div style="overflow-x: auto;">
                            <table class="modern-grid" id="salesReportGrid">
                                <thead>
                                    <tr>
                                        <th style="width: 15%;">Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©</th>
                                        <th style="width: 20%;">Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
                                        <th style="width: 12%;">Ø§Ù„Ù…Ø¨Ù„Øº</th>
                                        <th style="width: 10%;">Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©</th>
                                        <th style="width: 12%;">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
                                        <th style="width: 12%;">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</th>
                                        <th style="width: 12%;">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                    </tr>
                                </thead>
                                <tbody id="salesReportBody">
                                    <tr><td colspan="7" style="text-align: center; padding: 8px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¨ÙŠØ¹Ø§Øª</td></tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="button-group" style="justify-content: flex-start; margin-top: 12px;">
                            <button class="modern-button" onclick="printReport()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
                            <button class="modern-button" onclick="exportReport()">ğŸ’¾ ØªØµØ¯ÙŠØ±</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Form -->
            <div id="settingsForm" class="modern-form hidden">
                <div style="padding: 6px;">
                    <div style="font-weight: 600; margin-bottom: 12px; font-size: 14px; color: #0d6efd;">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</div>
                    
                    <div class="modern-groupbox">
                        <div class="modern-groupbox-title">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø±ÙƒØ©</div>
                        <div class="input-group">
                            <div>
                                <div class="modern-label">Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ©:</div>
                                <input type="text" id="companyName" class="modern-input" style="width: 100%;" value="Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø´Ø±ÙˆÙ‚">
                            </div>
                            <div>
                                <div class="modern-label">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</div>
                                <input type="tel" id="companyPhone" class="modern-input" style="width: 100%;">
                            </div>
                            <div>
                                <div class="modern-label">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:</div>
                                <input type="email" id="companyEmail" class="modern-input" style="width: 100%;">
                            </div>
                            <div>
                                <div class="modern-label">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</div>
                                <textarea id="companyAddress" class="modern-input" style="width: 100%; height: 50px;"></textarea>
                            </div>
                        </div>
                    </div>

                    <div class="modern-groupbox">
                        <div class="modern-groupbox-title">Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</div>
                        <div class="form-row">
                            <label class="form-label">Ù†Ø³Ø¨Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© (%):</label>
                            <input type="number" id="taxRate" class="modern-input form-control" value="15" min="0" max="100" step="0.1" style="width: 100px;">
                        </div>
                        <div class="form-row">
                            <label class="form-label">Ø§Ù„Ø¹Ù…Ù„Ø©:</label>
                            <select id="currency" class="modern-select form-control">
                                <option value="Ø±ÙŠØ§Ù„">Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ (ï·¼)</option>
                                <option value="Ø¯ÙˆÙ„Ø§Ø±">Ø¯ÙˆÙ„Ø§Ø± Ø£Ù…Ø±ÙŠÙƒÙŠ ($)</option>
                                <option value="ÙŠÙˆØ±Ùˆ">ÙŠÙˆØ±Ùˆ (â‚¬)</option>
                                <option value="Ø¯Ø±Ù‡Ù…">Ø¯Ø±Ù‡Ù… Ø¥Ù…Ø§Ø±Ø§ØªÙŠ (Ø¯.Ø¥)</option>
                            </select>
                        </div>
                    </div>

                    <div class="modern-groupbox">
                        <div class="modern-groupbox-title">Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</div>
                        <div class="button-group" style="justify-content: flex-start;">
                            <button class="modern-button" onclick="exportBackup()">ğŸ’¾ ØªØµØ¯ÙŠØ± Ø§Ù„Ù†Ø³Ø®Ø©</button>
                            <button class="modern-button" onclick="importBackup()">ğŸ“‚ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù†Ø³Ø®Ø©</button>
                            <button class="modern-button" onclick="clearAllData()">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
                        </div>
                    </div>

                    <div class="button-group" style="justify-content: flex-start; margin-top: 12px;">
                        <button class="modern-button" onclick="saveSettings()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
                    </div>
                </div>
            </div>

            <!-- Users Form -->
            <div id="usersForm" class="modern-form hidden">
                <div style="padding: 6px;">
                    <div style="font-weight: 600; margin-bottom: 12px; font-size: 14px; color: #0d6efd;">ğŸ” Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</div>
                    
                    <div class="modern-groupbox">
                        <div class="modern-groupbox-title">Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯</div>
                        <div class="input-group">
                            <div>
                                <div class="modern-label">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:</div>
                                <input type="text" id="userName" class="modern-input" style="width: 100%;">
                            </div>
                            <div>
                                <div class="modern-label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:</div>
                                <input type="password" id="userPassword" class="modern-input" style="width: 100%;">
                            </div>
                            <div>
                                <div class="modern-label">Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©:</div>
                                <select id="userRole" class="modern-select" style="width: 100%;">
                                    <option value="admin">Ù…Ø¯ÙŠØ±</option>
                                    <option value="cashier">Ø£Ù…ÙŠÙ† ØµÙ†Ø¯ÙˆÙ‚</option>
                                    <option value="manager">Ù…Ø¯ÙŠØ± Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</option>
                                    <option value="viewer">Ø¹Ø§Ø±Ø¶ ÙÙ‚Ø·</option>
                                </select>
                            </div>
                            <div>
                                <div class="modern-label">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:</div>
                                <input type="email" id="userEmail" class="modern-input" style="width: 100%;">
                            </div>
                        </div>
                        <div class="button-group" style="justify-content: flex-start; margin-top: 12px;">
                            <button class="modern-button" onclick="addUser()">â• Ø¥Ø¶Ø§ÙØ©</button>
                            <button class="modern-button" onclick="clearUserForm()">ğŸ—‘ï¸ Ù…Ø³Ø­</button>
                        </div>
                    </div>

                    <div class="modern-groupbox">
                        <div class="modern-groupbox-title">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</div>
                        <div style="overflow-x: auto;">
                            <table class="modern-grid" id="usersGrid">
                                <thead>
                                    <tr>
                                        <th style="width: 25%;">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
                                        <th style="width: 25%;">Ø§Ù„Ø¨Ø±ÙŠØ¯</th>
                                        <th style="width: 25%;">Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©</th>
                                        <th style="width: 25%;">Ø­Ø°Ù</th>
                                    </tr>
                                </thead>
                                <tbody id="usersBody">
                                    <tr><td colspan="4" style="text-align: center; padding: 8px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Default Welcome Screen -->
            <div id="welcomeForm" class="modern-form" style="display: flex; align-items: center; justify-content: center; height: 100%;">
                <div style="text-align: center; background: linear-gradient(135deg, #e7f3ff 0%, #fff 100%); border: 2px solid #0d6efd; border-radius: 8px; padding: 40px; min-width: 450px; box-shadow: 0 10px 40px rgba(13, 110, 253, 0.2);">
                    <div style="font-size: 36px; font-weight: 700; margin-bottom: 20px; color: #0d6efd;">ğŸ“š Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø´Ø±ÙˆÙ‚</div>
                    <div style="font-size: 18px; margin-bottom: 30px; color: #495057;">Ù…Ù†Ø¸ÙˆÙ…Ø© Ù…Ø¨ÙŠØ¹Ø§Øª Ù…ØªÙƒØ§Ù…Ù„Ø© Ø§Ø­ØªØ±Ø§ÙÙŠØ©</div>
                    <div style="background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%); border: 2px solid #0d6efd; border-radius: 8px; padding: 24px; margin-bottom: 24px;">
                        <div style="font-weight: 700; margin-bottom: 12px; color: #0d6efd; font-size: 16px;">Ø§Ù„Ø¥ØµØ¯Ø§Ø± 2026 Pro</div>
                        <div style="font-size: 13px; color: #495057; line-height: 1.6;">Ù†Ø¸Ø§Ù… Ù…ØªÙƒØ§Ù…Ù„ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª ÙˆØ§Ù„Ù…Ø®Ø²ÙˆÙ† ÙˆØ§Ù„ØªÙ‚Ø§Ø±ÙŠØ±<br>Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø£Ø­Ø¯Ø« ÙˆØ§Ù„Ø£ÙƒØ«Ø± Ø§Ø­ØªØ±Ø§ÙÙŠØ©</div>
                        <div style="font-size: 12px; color: #868e96; margin-top: 12px;">Â© 2026 Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Ù„Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø´Ø±ÙˆÙ‚</div>
                    </div>
                    <div style="font-size: 13px; color: #495057; margin-top: 20px; background: #fff3e0; padding: 12px; border-radius: 6px; border-right: 4px solid #fd7e14;">
                        ğŸ’¡ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø§Ø®ØªØµØ§Ø±Ø§Øª: F1-F12 Ù„Ù„ÙˆØµÙˆÙ„ Ø§Ù„Ø³Ø±ÙŠØ¹ Ù„Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…Ø®ØªÙ„ÙØ©
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Status Bar -->
    <div class="modern-statusbar">
        <div class="modern-statusbar-panel">Ø¬Ø§Ù‡Ø²</div>
        <div class="modern-statusbar-panel" style="flex: 0;" id="statusTime">00:00:00</div>
    </div>

    <!-- Modals -->
    <!-- Edit Item Modal -->
    <div id="editItemModal" class="modern-window">
        <div class="modern-window-caption">
            <span>ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨Ù†Ø¯</span>
            <button class="modern-window-close" onclick="closeEditItemModal()">âœ•</button>
        </div>
        <div class="modern-window-content">
            <div class="form-row">
                <label class="form-label">Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯:</label>
                <input type="number" id="editPrice" class="modern-input form-control" step="0.01">
            </div>
            <div class="form-row">
                <label class="form-label">Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:</label>
                <input type="number" id="editQuantity" class="modern-input form-control" min="1">
            </div>
            <div class="button-group" style="justify-content: flex-start;">
                <button class="modern-button" onclick="saveItemEdit()">âœ… Ø­ÙØ¸</button>
                <button class="modern-button" style="background: #6c757d; border-color: #6c757d;" onclick="closeEditItemModal()">âŒ Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>
    </div>

    <!-- Pending Invoices Modal -->
    <div id="pendingInvoicesModal" class="modern-window" style="min-width: 500px;">
        <div class="modern-window-caption">
            <span>â±ï¸ Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©</span>
            <button class="modern-window-close" onclick="closePendingInvoicesModal()">âœ•</button>
        </div>
        <div class="modern-window-content" style="overflow-y: auto; max-height: 400px;">
            <div id="pendingInvoicesList" style="padding: 8px;"></div>
        </div>
        <div style="padding: 8px; text-align: center; border-top: 1px solid #dee2e6;">
            <button class="modern-button" onclick="closePendingInvoicesModal()">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
    </div>

    <!-- Message Box -->
    <div id="messageBox" class="message-box">
        <div class="message-box-title" id="messageTitle">Ù…Ø¹Ù„ÙˆÙ…Ø©</div>
        <div class="message-box-content" id="messageContent"></div>
        <div class="message-box-buttons">
            <button class="modern-button" onclick="closeMessageBox()">Ù…ÙˆØ§ÙÙ‚</button>
        </div>
    </div>

    <!-- Hidden file input -->
    <input type="file" id="importFileInput" class="hidden" accept=".json" onchange="importBackupFile(event)">

    <script>
        // Global Data Store
        let appData = {
            products: [],
            customers: [],
            employees: [],
            sales: [],
            returns: [],
            wholesale: [],
            expenses: [],
            assets: [],
            bankTransactions: [],
            imports: [],
            users: [],
            invoices: [],
            purchases: []
        };

        let currentInvoice = {
            id: null,
            number: '',
            items: [],
            customer: '',
            paymentMethod: 'cash',
            notes: '',
            date: new Date().toLocaleDateString('ar-SA'),
            time: new Date().toLocaleTimeString('ar-SA'),
            subtotal: 0,
            tax: 0,
            total: 0,
            status: 'draft'
        };

        let editingProductId = null;
        let editingItemIndex = null;

        // Keyboard Shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.key === 'F1') { e.preventDefault(); newInvoice(); }
            if (e.key === 'F2') { e.preventDefault(); openFile(); }
            if (e.key === 'F3') { e.preventDefault(); saveFile(); }
            if (e.key === 'F4') { e.preventDefault(); showProductsForm(); }
            if (e.key === 'F5') { e.preventDefault(); showCustomersForm(); }
            if (e.key === 'F6') { e.preventDefault(); showEmployeesForm(); }
            if (e.key === 'F7') { e.preventDefault(); showPointOfSale(); }
            if (e.key === 'F8') { e.preventDefault(); showReturns(); }
            if (e.key === 'F9') { e.preventDefault(); showWholesale(); }
            if (e.key === 'F10') { e.preventDefault(); showGeneralReport(); }
            if (e.key === 'F11') { e.preventDefault(); showSettings(); }
            if (e.key === 'F12') { e.preventDefault(); showUsersForm(); }
        });

        // Initialize
        window.addEventListener('load', function() {
            loadFromStorage();
            setupMenus();
            setupScannerInput();
            updateStatusBar();
            setInterval(updateStatusBar, 1000);
            displayAllLists();
            showPointOfSale();
        });

        // Menu Setup
        function setupMenus() {
            document.querySelectorAll('.menu-item').forEach(item => {
                item.addEventListener('click', function(e) {
                    const submenu = this.querySelector('.submenu');
                    if (submenu) {
                        e.preventDefault();
                        document.querySelectorAll('.submenu').forEach(s => s.classList.remove('show'));
                        submenu.classList.add('show');
                    }
                });
            });

            document.addEventListener('click', function(e) {
                if (!e.target.closest('.menu-item')) {
                    document.querySelectorAll('.submenu').forEach(s => s.classList.remove('show'));
                }
            });
        }

        // Status Bar
        function updateStatusBar() {
            const now = new Date();
            document.getElementById('statusTime').textContent = now.toLocaleTimeString('ar-SA');
        }

        // Show/Hide Forms
        function hideAllForms() {
            document.querySelectorAll('[id$="Form"]').forEach(el => el.classList.add('hidden'));
            document.getElementById('welcomeForm').style.display = 'none';
        }

        function showPointOfSale() {
            hideAllForms();
            document.getElementById('posForm').classList.remove('hidden');
            setTimeout(() => document.getElementById('scannerInput').focus(), 100);
        }

        function showProductsForm() {
            hideAllForms();
            document.getElementById('productsForm').classList.remove('hidden');
            displayProductsList();
        }

        function showCustomersForm() {
            hideAllForms();
            document.getElementById('customersForm').classList.remove('hidden');
            displayCustomersList();
        }

        function showEmployeesForm() {
            hideAllForms();
            document.getElementById('employeesForm').classList.remove('hidden');
            displayEmployeesList();
        }

        function showReturns() {
            hideAllForms();
            document.getElementById('returnsForm').classList.remove('hidden');
            displayReturnsList();
        }

        function showWholesale() {
            hideAllForms();
            document.getElementById('wholesaleForm').classList.remove('hidden');
            displayWholesaleList();
        }

        function showGeneralReport() {
            hideAllForms();
            document.getElementById('reportsForm').classList.remove('hidden');
            updateReports();
        }

        function showSettings() {
            hideAllForms();
            document.getElementById('settingsForm').classList.remove('hidden');
            loadSettings();
        }

        function showUsersForm() {
            hideAllForms();
            document.getElementById('usersForm').classList.remove('hidden');
            displayUsersList();
        }

        function showPurchases() {
            showMessageBox('Ù‚Ø±ÙŠØ¨Ø§Ù‹', 'Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª Ù‚Ø±ÙŠØ¨Ø§Ù‹');
        }

        function showExpenses() {
            showMessageBox('Ù‚Ø±ÙŠØ¨Ø§Ù‹', 'Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ù‚Ø±ÙŠØ¨Ø§Ù‹');
        }

        function showSalesReport() {
            showGeneralReport();
        }

        function showInventoryReport() {
            showMessageBox('Ù‚Ø±ÙŠØ¨Ø§Ù‹', 'Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ù‚Ø±ÙŠØ¨Ø§Ù‹');
        }

        function showExpensesReport() {
            showMessageBox('Ù‚Ø±ÙŠØ¨Ø§Ù‹', 'Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ù‚Ø±ÙŠØ¨Ø§Ù‹');
        }

        function showSuppliersForm() {
            showMessageBox('Ù‚Ø±ÙŠØ¨Ø§Ù‹', 'Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† Ù‚Ø±ÙŠØ¨Ø§Ù‹');
        }

        function showAbout() {
            showMessageBox('Ø¹Ù† Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬', 'Ù…Ù†Ø¸ÙˆÙ…Ø© Ù…Ø¨ÙŠØ¹Ø§Øª Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø´Ø±ÙˆÙ‚\nØ§Ù„Ø¥ØµØ¯Ø§Ø± 2026 Pro\nÙ†Ø³Ø®Ø© Ø§Ø­ØªØ±Ø§ÙÙŠØ© Ù…ØªÙ‚Ø¯Ù…Ø© Ù…Ø¹ Ø§Ø®ØªØµØ§Ø±Ø§Øª Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­\nØ¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Â© 2026');
        }

        // Scanner Input
        function setupScannerInput() {
            const input = document.getElementById('scannerInput');
            input.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    const code = this.value.trim();
                    const product = appData.products.find(p => p.code === code);
                    
                    if (product) {
                        addItemToInvoice(product);
                        this.value = '';
                    } else {
                        showMessageBox('Ø®Ø·Ø£', 'Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯: ' + code);
                        this.value = '';
                    }
                }
            });
        }

        // Point of Sale Functions
        function addItemToInvoice(product) {
            const existingItem = currentInvoice.items.find(item => item.id === product.id);
            
            if (existingItem) {
                existingItem.quantity++;
            } else {
                currentInvoice.items.push({
                    id: product.id,
                    code: product.code,
                    name: product.name,
                    price: parseFloat(product.price),
                    quantity: 1
                });
            }
            
            updateInvoiceDisplay();
        }

        function updateInvoiceDisplay() {
            const tbody = document.getElementById('invoiceBody');
            
            if (currentInvoice.items.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 8px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª</td></tr>';
            } else {
                tbody.innerHTML = currentInvoice.items.map((item, index) => `
                    <tr>
                        <td>${item.name}</td>
                        <td>${item.code}</td>
                        <td style="text-align: center;">
                            <input type="number" value="${item.quantity}" min="1" style="width: 50px; padding: 4px; border-radius: 3px;" onchange="updateItemQuantity(${index}, this.value)">
                        </td>
                        <td style="text-align: center;">${item.price.toFixed(2)}</td>
                        <td style="text-align: center; font-weight: 600;">${(item.quantity * item.price).toFixed(2)}</td>
                        <td style="text-align: center;">
                            <button class="modern-button" style="padding: 4px 8px; font-size: 11px; min-width: auto;" onclick="removeFromInvoice(${index})">Ø­Ø°Ù</button>
                        </td>
                        <td style="text-align: center;">
                            <button class="modern-button" style="padding: 4px 8px; font-size: 11px; min-width: auto;" onclick="editItem(${index})">ØªØ¹Ø¯ÙŠÙ„</button>
                        </td>
                    </tr>
                `).join('');
            }
            
            updateInvoiceSummary();
        }

        function updateItemQuantity(index, value) {
            const qty = parseInt(value);
            if (qty > 0) {
                currentInvoice.items[index].quantity = qty;
                updateInvoiceDisplay();
            }
        }

        function removeFromInvoice(index) {
            currentInvoice.items.splice(index, 1);
            updateInvoiceDisplay();
        }

        function editItem(index) {
            editingItemIndex = index;
            const item = currentInvoice.items[index];
            document.getElementById('editPrice').value = item.price;
            document.getElementById('editQuantity').value = item.quantity;
            document.getElementById('editItemModal').classList.add('show');
        }

        function saveItemEdit() {
            if (editingItemIndex !== null) {
                const newPrice = parseFloat(document.getElementById('editPrice').value);
                const newQuantity = parseInt(document.getElementById('editQuantity').value);
                
                if (newPrice > 0 && newQuantity > 0) {
                    currentInvoice.items[editingItemIndex].price = newPrice;
                    currentInvoice.items[editingItemIndex].quantity = newQuantity;
                    updateInvoiceDisplay();
                    closeEditItemModal();
                } else {
                    showMessageBox('Ø®Ø·Ø£', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù‚ÙŠÙ… ØµØ­ÙŠØ­Ø©');
                }
            }
        }

        function closeEditItemModal() {
            document.getElementById('editItemModal').classList.remove('show');
            editingItemIndex = null;
        }

        function updateInvoiceSummary() {
            const itemCount = currentInvoice.items.length;
            const subtotal = currentInvoice.items.reduce((sum, item) => sum + (item.quantity * item.price), 0);
            const taxRate = parseFloat(document.getElementById('taxRate')?.value || 15) / 100;
            const tax = subtotal * taxRate;
            const total = subtotal + tax;

            currentInvoice.subtotal = subtotal;
            currentInvoice.tax = tax;
            currentInvoice.total = total;

            document.getElementById('itemCount').textContent = itemCount;
            document.getElementById('subtotal').textContent = subtotal.toFixed(2);
            document.getElementById('taxAmount').textContent = tax.toFixed(2);
            document.getElementById('totalAmount').textContent = total.toFixed(2);
        }

        function completeInvoice() {
            if (currentInvoice.items.length === 0) {
                showMessageBox('Ø®Ø·Ø£', 'Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙØ§Ø±ØºØ©');
                return;
            }

            const customer = document.getElementById('customerName').value || 'Ø¹Ù…ÙŠÙ„ Ù†Ù‚Ø¯ÙŠ';
            const paymentMethod = document.getElementById('paymentMethod').value;
            const notes = document.getElementById('invoiceNotes').value;

            currentInvoice.number = 'INV-' + (appData.sales.length + 1);
            currentInvoice.customer = customer;
            currentInvoice.paymentMethod = paymentMethod;
            currentInvoice.notes = notes;
            currentInvoice.status = 'completed';
            currentInvoice.date = new Date().toLocaleDateString('ar-SA');
            currentInvoice.time = new Date().toLocaleTimeString('ar-SA');

            appData.sales.push({...currentInvoice});
            appData.invoices.push({...currentInvoice});
            saveToStorage();
            
            showMessageBox('Ù†Ø¬Ø§Ø­', 'ØªÙ… Ø¥ØªÙ…Ø§Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø¨Ø±Ù‚Ù…: ' + currentInvoice.number);
            clearInvoice();
        }

        function clearInvoice() {
            currentInvoice = {
                id: null,
                number: '',
                items: [],
                customer: '',
                paymentMethod: 'cash',
                notes: '',
                date: new Date().toLocaleDateString('ar-SA'),
                time: new Date().toLocaleTimeString('ar-SA'),
                subtotal: 0,
                tax: 0,
                total: 0,
                status: 'draft'
            };
            document.getElementById('customerName').value = '';
            document.getElementById('paymentMethod').value = 'cash';
            document.getElementById('invoiceNotes').value = '';
            updateInvoiceDisplay();
            document.getElementById('scannerInput').focus();
        }

        function newInvoice() {
            clearInvoice();
            showPointOfSale();
        }

        function togglePendingInvoices() {
            const modal = document.getElementById('pendingInvoicesModal');
            if (modal.classList.contains('show')) {
                modal.classList.remove('show');
            } else {
                updatePendingInvoicesList();
                modal.classList.add('show');
            }
        }

        function closePendingInvoicesModal() {
            document.getElementById('pendingInvoicesModal').classList.remove('show');
        }

        function updatePendingInvoicesList() {
            const pending = appData.invoices.filter(inv => inv.status === 'draft');
            const listDiv = document.getElementById('pendingInvoicesList');

            if (pending.length === 0) {
                listDiv.innerHTML = '<div style="padding: 8px; text-align: center; color: #868e96;">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙÙˆØ§ØªÙŠØ± Ù…Ø¹Ù„Ù‚Ø©</div>';
                return;
            }

            listDiv.innerHTML = pending.map((inv, idx) => `
                <div style="background: linear-gradient(135deg, #fff3e0 0%, #fff 100%); border: 1px solid #ffc107; border-radius: 6px; padding: 12px; margin: 8px 0;">
                    <div style="font-weight: 600; color: #fd7e14;">${inv.number || 'ÙØ§ØªÙˆØ±Ø© ' + idx}</div>
                    <div style="font-size: 11px; color: #495057;">Ø§Ù„Ø¹Ù…ÙŠÙ„: ${inv.customer}</div>
                    <div style="font-size: 11px; color: #495057;">Ø§Ù„Ù…Ø¨Ù„Øº: ${inv.total.toFixed(2)}</div>
                    <div style="font-size: 11px; color: #495057;">Ø§Ù„ØªØ§Ø±ÙŠØ®: ${inv.date}</div>
                    <button class="modern-button" style="width: 100%; margin-top: 8px;" onclick="loadPendingInvoice(${appData.invoices.indexOf(inv)})">ÙØªØ­</button>
                </div>
            `).join('');
        }

        function loadPendingInvoice(index) {
            const invoice = appData.invoices[index];
            currentInvoice = {...invoice};
            document.getElementById('customerName').value = currentInvoice.customer;
            document.getElementById('paymentMethod').value = currentInvoice.paymentMethod;
            document.getElementById('invoiceNotes').value = currentInvoice.notes;
            updateInvoiceDisplay();
            closePendingInvoicesModal();
            showPointOfSale();
        }

        function printInvoice() {
            if (currentInvoice.items.length === 0) {
                showMessageBox('Ø®Ø·Ø£', 'Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙØ§Ø±ØºØ©');
                return;
            }

            const content = `
                <div style="text-align: center; padding: 20px; font-family: Arial; direction: rtl;">
                    <h2 style="margin: 0; color: #0d6efd;">ğŸ“š Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø´Ø±ÙˆÙ‚</h2>
                    <p style="margin: 5px 0; font-size: 12px;">ÙØ§ØªÙˆØ±Ø© Ø¨ÙŠØ¹</p>
                    <hr>
                    <div style="text-align: right; margin: 15px 0;">
                        <p><strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> ${currentInvoice.date}</p>
                        <p><strong>Ø§Ù„ÙˆÙ‚Øª:</strong> ${currentInvoice.time}</p>
                        <p><strong>Ø§Ù„Ø¹Ù…ÙŠÙ„:</strong> ${currentInvoice.customer}</p>
                        <p><strong>Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©:</strong> ${currentInvoice.number}</p>
                    </div>
                    <table style="width: 100%; border-collapse: collapse; margin: 15px 0;">
                        <thead>
                            <tr style="border-bottom: 2px solid #0d6efd;">
                                <th style="padding: 8px; text-align: right;">Ø§Ù„ØµÙ†Ù</th>
                                <th style="padding: 8px; text-align: center;">Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                                <th style="padding: 8px; text-align: center;">Ø§Ù„Ø³Ø¹Ø±</th>
                                <th style="padding: 8px; text-align: center;">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${currentInvoice.items.map(item => `
                                <tr style="border-bottom: 1px solid #dee2e6;">
                                    <td style="padding: 6px; text-align: right;">${item.name}</td>
                                    <td style="padding: 6px; text-align: center;">${item.quantity}</td>
                                    <td style="padding: 6px; text-align: center;">${item.price.toFixed(2)}</td>
                                    <td style="padding: 6px; text-align: center;">${(item.quantity * item.price).toFixed(2)}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                    <div style="text-align: left; border-top: 2px solid #0d6efd; padding-top: 10px; margin-top: 10px;">
                        <p><strong>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù‚Ø¨Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©:</strong> ${currentInvoice.subtotal.toFixed(2)}</p>
                        <p><strong>Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©:</strong> ${currentInvoice.tax.toFixed(2)}</p>
                        <p style="font-size: 16px; color: #0d6efd;"><strong>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:</strong> ${currentInvoice.total.toFixed(2)}</p>
                    </div>
                    <div style="margin-top: 20px; text-align: center; font-size: 12px; color: #868e96;">
                        <p>Ø´ÙƒØ±Ø§Ù‹ Ù„ØªØ¹Ø§Ù…Ù„ÙƒÙ… Ù…Ø¹Ù†Ø§</p>
                    </div>
                </div>
            `;

            const element = document.createElement('div');
            element.innerHTML = content;
            const opt = {
                margin: 10,
                filename: currentInvoice.number + '.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { orientation: 'portrait', unit: 'mm', format: 'a4' }
            };
            html2pdf().set(opt).from(element).save();
        }

        // Products Management
        function addProduct() {
            const code = document.getElementById('productCode').value;
            const name = document.getElementById('productName').value;
            const category = document.getElementById('productCategory').value;
            const price = parseFloat(document.getElementById('productPrice').value);
            const quantity = parseInt(document.getElementById('productQuantity').value);
            const supplier = document.getElementById('productSupplier').value;

            if (!code || !name || !price || isNaN(price)) {
                showMessageBox('Ø®Ø·Ø£', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
                return;
            }

            const product = {
                id: Date.now(),
                code,
                name,
                category,
                price,
                quantity: quantity || 0,
                supplier,
                date: new Date().toLocaleDateString('ar-SA')
            };

            appData.products.push(product);
            saveToStorage();
            displayProductsList();
            clearProductForm();
            showMessageBox('Ù†Ø¬Ø§Ø­', 'ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµÙ†Ù Ø¨Ù†Ø¬Ø§Ø­');
        }

        function updateProduct() {
            if (!editingProductId) {
                showMessageBox('Ø®Ø·Ø£', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± ØµÙ†Ù Ø£ÙˆÙ„Ø§Ù‹');
                return;
            }

            const product = appData.products.find(p => p.id === editingProductId);
            if (product) {
                product.code = document.getElementById('productCode').value;
                product.name = document.getElementById('productName').value;
                product.category = document.getElementById('productCategory').value;
                product.price = parseFloat(document.getElementById('productPrice').value);
                product.quantity = parseInt(document.getElementById('productQuantity').value) || 0;
                product.supplier = document.getElementById('productSupplier').value;

                saveToStorage();
                displayProductsList();
                clearProductForm();
                showMessageBox('Ù†Ø¬Ø§Ø­', 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙ†Ù Ø¨Ù†Ø¬Ø§Ø­');
            }
        }

        function clearProductForm() {
            document.getElementById('productCode').value = '';
            document.getElementById('productName').value = '';
            document.getElementById('productCategory').value = 'Ø§Ø®ØªØ± Ø§Ù„ÙØ¦Ø©';
            document.getElementById('productPrice').value = '';
            document.getElementById('productQuantity').value = '';
            document.getElementById('productSupplier').value = '';
            editingProductId = null;
        }

        function displayProductsList() {
            const tbody = document.getElementById('productsBody');
            
            if (appData.products.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 8px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª</td></tr>';
                return;
            }

            tbody.innerHTML = appData.products.map(p => `
                <tr>
                    <td>${p.code}</td>
                    <td>${p.name}</td>
                    <td>${p.category}</td>
                    <td style="text-align: center;">${p.price.toFixed(2)}</td>
                    <td style="text-align: center;">${p.quantity}</td>
                    <td>${p.supplier || '-'}</td>
                    <td style="text-align: center;">
                        <button class="modern-button" style="padding: 4px 8px; font-size: 11px; min-width: auto;" onclick="deleteProduct(${p.id})">Ø­Ø°Ù</button>
                    </td>
                </tr>
            `).join('');
        }

        function deleteProduct(id) {
            if (confirm('Ù‡Ù„ ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØµÙ†ÙØŸ')) {
                appData.products = appData.products.filter(p => p.id !== id);
                saveToStorage();
                displayProductsList();
            }
        }

        // Customers Management
        function addCustomer() {
            const code = document.getElementById('customerCode').value;
            const name = document.getElementById('customerNameInput').value;
            const type = document.getElementById('customerType').value;
            const phone = document.getElementById('customerPhone').value;
            const email = document.getElementById('customerEmail').value;
            const address = document.getElementById('customerAddress').value;

            if (!code || !name) {
                showMessageBox('Ø®Ø·Ø£', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
                return;
            }

            const customer = {
                id: Date.now(),
                code,
                name,
                type,
                phone,
                email,
                address,
                balance: 0,
                date: new Date().toLocaleDateString('ar-SA')
            };

            appData.customers.push(customer);
            saveToStorage();
            displayCustomersList();
            clearCustomerForm();
            showMessageBox('Ù†Ø¬Ø§Ø­', 'ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­');
        }

        function clearCustomerForm() {
            document.getElementById('customerCode').value = '';
            document.getElementById('customerNameInput').value = '';
            document.getElementById('customerType').value = 'retail';
            document.getElementById('customerPhone').value = '';
            document.getElementById('customerEmail').value = '';
            document.getElementById('customerAddress').value = '';
        }

        function displayCustomersList() {
            const tbody = document.getElementById('customersBody');
            
            if (appData.customers.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 8px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù…Ù„Ø§Ø¡</td></tr>';
                return;
            }

            const typeNames = { retail: 'ØªØ¬Ø²Ø¦Ø©', wholesale: 'Ø¬Ù…Ù„Ø©', corporate: 'Ø´Ø±ÙƒØ©' };

            tbody.innerHTML = appData.customers.map(c => `
                <tr>
                    <td>${c.code}</td>
                    <td>${c.name}</td>
                    <td>${typeNames[c.type]}</td>
                    <td>${c.phone || '-'}</td>
                    <td style="text-align: center; font-weight: 600;">${c.balance.toFixed(2)}</td>
                    <td style="text-align: center;">
                        <button class="modern-button" style="padding: 4px 8px; font-size: 11px; min-width: auto;" onclick="deleteCustomer(${c.id})">Ø­Ø°Ù</button>
                    </td>
                </tr>
            `).join('');
        }

        function deleteCustomer(id) {
            if (confirm('Ù‡Ù„ ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù…ÙŠÙ„ØŸ')) {
                appData.customers = appData.customers.filter(c => c.id !== id);
                saveToStorage();
                displayCustomersList();
            }
        }

        // Employees Management
        function addEmployee() {
            const code = document.getElementById('employeeCode').value;
            const name = document.getElementById('employeeName').value;
            const position = document.getElementById('employeePosition').value;
            const salary = parseFloat(document.getElementById('employeeSalary').value);
            const phone = document.getElementById('employeePhone').value;
            const startDate = document.getElementById('employeeStartDate').value;

            if (!code || !name || !salary || isNaN(salary)) {
                showMessageBox('Ø®Ø·Ø£', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
                return;
            }

            const employee = {
                id: Date.now(),
                code,
                name,
                position,
                salary,
                phone,
                startDate,
                date: new Date().toLocaleDateString('ar-SA')
            };

            appData.employees.push(employee);
            saveToStorage();
            displayEmployeesList();
            clearEmployeeForm();
            showMessageBox('Ù†Ø¬Ø§Ø­', 'ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ¸Ù Ø¨Ù†Ø¬Ø§Ø­');
        }

        function clearEmployeeForm() {
            document.getElementById('employeeCode').value = '';
            document.getElementById('employeeName').value = '';
            document.getElementById('employeePosition').value = '';
            document.getElementById('employeeSalary').value = '';
            document.getElementById('employeePhone').value = '';
            document.getElementById('employeeStartDate').value = '';
        }

        function displayEmployeesList() {
            const tbody = document.getElementById('employeesBody');
            
            if (appData.employees.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 8px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ¸ÙÙŠÙ†</td></tr>';
                return;
            }

            tbody.innerHTML = appData.employees.map(e => `
                <tr>
                    <td>${e.code}</td>
                    <td>${e.name}</td>
                    <td>${e.position}</td>
                    <td style="text-align: center;">${e.salary.toFixed(2)}</td>
                    <td>${e.startDate || '-'}</td>
                    <td style="text-align: center;">
                        <button class="modern-button" style="padding: 4px 8px; font-size: 11px; min-width: auto;" onclick="deleteEmployee(${e.id})">Ø­Ø°Ù</button>
                    </td>
                </tr>
            `).join('');
        }

        function deleteEmployee(id) {
            if (confirm('Ù‡Ù„ ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ¸ÙØŸ')) {
                appData.employees = appData.employees.filter(e => e.id !== id);
                saveToStorage();
                displayEmployeesList();
            }
        }

        // Returns Management
        function addReturn() {
            const code = document.getElementById('returnCode').value;
            const product = document.getElementById('returnProduct').value;
            const quantity = parseInt(document.getElementById('returnQuantity').value);
            const reason = document.getElementById('returnReason').value;

            if (!code || !product || !quantity || isNaN(quantity)) {
                showMessageBox('Ø®Ø·Ø£', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
                return;
            }

            const returnRecord = {
                id: Date.now(),
                code,
                product,
                quantity,
                reason,
                date: new Date().toLocaleDateString('ar-SA')
            };

            appData.returns.push(returnRecord);
            saveToStorage();
            displayReturnsList();
            clearReturnForm();
            showMessageBox('Ù†Ø¬Ø§Ø­', 'ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªØ±Ø¬ÙŠØ¹ Ø¨Ù†Ø¬Ø§Ø­');
        }

        function clearReturnForm() {
            document.getElementById('returnCode').value = '';
            document.getElementById('returnProduct').value = '';
            document.getElementById('returnQuantity').value = '';
            document.getElementById('returnReason').value = '';
        }

        function displayReturnsList() {
            const tbody = document.getElementById('returnsBody');
            
            if (appData.returns.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 8px;">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ±Ø¬ÙŠØ¹Ø§Øª</td></tr>';
                return;
            }

            tbody.innerHTML = appData.returns.map(r => `
                <tr>
                    <td>${r.code}</td>
                    <td>${r.product}</td>
                    <td style="text-align: center;">${r.quantity}</td>
                    <td>${r.reason}</td>
                    <td>${r.date}</td>
                    <td style="text-align: center;">
                        <button class="modern-button" style="padding: 4px 8px; font-size: 11px; min-width: auto;" onclick="deleteReturn(${r.id})">Ø­Ø°Ù</button>
                    </td>
                </tr>
            `).join('');
        }

        function deleteReturn(id) {
            if (confirm('Ù‡Ù„ ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØªØ±Ø¬ÙŠØ¹ØŸ')) {
                appData.returns = appData.returns.filter(r => r.id !== id);
                saveToStorage();
                displayReturnsList();
            }
        }

        // Wholesale Management
        function addWholesale() {
            const customer = document.getElementById('wholesaleCustomer').value;
            const product = document.getElementById('wholesaleProduct').value;
            const quantity = parseInt(document.getElementById('wholesaleQuantity').value);
            const discount = parseFloat(document.getElementById('wholesaleDiscount').value) || 0;

            if (!customer || !product || !quantity || isNaN(quantity)) {
                showMessageBox('Ø®Ø·Ø£', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
                return;
            }

            const prod = appData.products.find(p => p.name === product);
            if (!prod) {
                showMessageBox('Ø®Ø·Ø£', 'Ø§Ù„ØµÙ†Ù ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
                return;
            }

            const subtotal = quantity * prod.price;
            const discountAmount = (subtotal * discount) / 100;
            const total = subtotal - discountAmount;

            const wholesale = {
                id: Date.now(),
                customer,
                product,
                quantity,
                discount,
                subtotal,
                discountAmount,
                total,
                date: new Date().toLocaleDateString('ar-SA')
            };

            appData.wholesale.push(wholesale);
            saveToStorage();
            displayWholesaleList();
            clearWholesaleForm();
            showMessageBox('Ù†Ø¬Ø§Ø­', 'ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ Ø§Ù„Ø¬Ù…Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­');
        }

        function clearWholesaleForm() {
            document.getElementById('wholesaleCustomer').value = '';
            document.getElementById('wholesaleProduct').value = '';
            document.getElementById('wholesaleQuantity').value = '';
            document.getElementById('wholesaleDiscount').value = '';
        }

        function displayWholesaleList() {
            const tbody = document.getElementById('wholesaleBody');
            
            if (appData.wholesale.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 8px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª</td></tr>';
                return;
            }

            tbody.innerHTML = appData.wholesale.map(w => `
                <tr>
                    <td>${w.customer}</td>
                    <td>${w.product}</td>
                    <td style="text-align: center;">${w.quantity}</td>
                    <td style="text-align: center;">${w.discount}%</td>
                    <td style="text-align: center; font-weight: 600;">${w.total.toFixed(2)}</td>
                    <td>${w.date}</td>
                    <td style="text-align: center;">
                        <button class="modern-button" style="padding: 4px 8px; font-size: 11px; min-width: auto;" onclick="deleteWholesale(${w.id})">Ø­Ø°Ù</button>
                    </td>
                </tr>
            `).join('');
        }

        function deleteWholesale(id) {
            if (confirm('Ù‡Ù„ ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ØŸ')) {
                appData.wholesale = appData.wholesale.filter(w => w.id !== id);
                saveToStorage();
                displayWholesaleList();
            }
        }

        // Reports
        function updateReports() {
            const totalSales = appData.sales.reduce((sum, s) => sum + s.total, 0);
            const totalExpenses = appData.expenses.reduce((sum, e) => sum + e.amount, 0);
            const netProfit = totalSales - totalExpenses;

            document.getElementById('totalSales').textContent = totalSales.toFixed(2);
            document.getElementById('totalExpenses').textContent = totalExpenses.toFixed(2);
            document.getElementById('netProfit').textContent = netProfit.toFixed(2);

            displaySalesReport();
        }

        function displaySalesReport() {
            const tbody = document.getElementById('salesReportBody');
            
            if (appData.sales.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 8px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¨ÙŠØ¹Ø§Øª</td></tr>';
                return;
            }

            const paymentNames = { cash: 'Ù†Ù‚Ø¯Ø§Ù‹', card: 'Ø¨Ø·Ø§Ù‚Ø©', check: 'Ø´ÙŠÙƒ', credit: 'Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø³Ø§Ø¨' };

            tbody.innerHTML = appData.sales.map(s => `
                <tr>
                    <td>${s.number || 'INV-' + s.id}</td>
                    <td>${s.customer}</td>
                    <td style="text-align: center;">${s.subtotal.toFixed(2)}</td>
                    <td style="text-align: center;">${s.tax.toFixed(2)}</td>
                    <td style="text-align: center; font-weight: 600;">${s.total.toFixed(2)}</td>
                    <td>${paymentNames[s.paymentMethod]}</td>
                    <td>${s.date}</td>
                </tr>
            `).join('');
        }

        function printReport() {
            window.print();
        }

        function exportReport() {
            const csv = generateCSV(appData.sales);
            downloadCSV(csv, 'sales_report.csv');
        }

        function generateCSV(data) {
            const headers = ['Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©', 'Ø§Ù„Ø¹Ù…ÙŠÙ„', 'Ø§Ù„Ù…Ø¨Ù„Øº', 'Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©', 'Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ', 'Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹', 'Ø§Ù„ØªØ§Ø±ÙŠØ®'];
            const rows = data.map(s => [
                s.number || s.id,
                s.customer,
                s.subtotal.toFixed(2),
                s.tax.toFixed(2),
                s.total.toFixed(2),
                s.paymentMethod,
                s.date
            ]);

            let csv = headers.join(',') + '\n';
            rows.forEach(row => csv += row.join(',') + '\n');
            return csv;
        }

        function downloadCSV(csv, filename) {
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            link.click();
        }

        // Users Management
        function addUser() {
            const name = document.getElementById('userName').value;
            const password = document.getElementById('userPassword').value;
            const role = document.getElementById('userRole').value;
            const email = document.getElementById('userEmail').value;

            if (!name || !password) {
                showMessageBox('Ø®Ø·Ø£', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„');
                return;
            }

            const user = {
                id: Date.now(),
                name,
                password,
                role,
                email,
                date: new Date().toLocaleDateString('ar-SA')
            };

            appData.users.push(user);
            saveToStorage();
            displayUsersList();
            clearUserForm();
            showMessageBox('Ù†Ø¬Ø§Ø­', 'ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­');
        }

        function clearUserForm() {
            document.getElementById('userName').value = '';
            document.getElementById('userPassword').value = '';
            document.getElementById('userRole').value = 'cashier';
            document.getElementById('userEmail').value = '';
        }

        function displayUsersList() {
            const tbody = document.getElementById('usersBody');
            
            if (appData.users.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" style="text-align: center; padding: 8px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</td></tr>';
                return;
            }

            const roleNames = { admin: 'Ù…Ø¯ÙŠØ±', cashier: 'Ø£Ù…ÙŠÙ† ØµÙ†Ø¯ÙˆÙ‚', manager: 'Ù…Ø¯ÙŠØ± Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†', viewer: 'Ø¹Ø§Ø±Ø¶ ÙÙ‚Ø·' };

            tbody.innerHTML = appData.users.map(u => `
                <tr>
                    <td>${u.name}</td>
                    <td>${u.email || '-'}</td>
                    <td>${roleNames[u.role]}</td>
                    <td style="text-align: center;">
                        <button class="modern-button" style="padding: 4px 8px; font-size: 11px; min-width: auto;" onclick="deleteUser(${u.id})">Ø­Ø°Ù</button>
                    </td>
                </tr>
            `).join('');
        }

        function deleteUser(id) {
            if (confirm('Ù‡Ù„ ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŸ')) {
                appData.users = appData.users.filter(u => u.id !== id);
                saveToStorage();
                displayUsersList();
            }
        }

        // Settings
        function loadSettings() {
            const settings = JSON.parse(localStorage.getItem('appSettings') || '{}');
            document.getElementById('companyName').value = settings.companyName || 'Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø´Ø±ÙˆÙ‚';
            document.getElementById('companyPhone').value = settings.companyPhone || '';
            document.getElementById('companyEmail').value = settings.companyEmail || '';
            document.getElementById('companyAddress').value = settings.companyAddress || '';
            document.getElementById('taxRate').value = settings.taxRate || 15;
            document.getElementById('currency').value = settings.currency || 'Ø±ÙŠØ§Ù„';
        }

        function saveSettings() {
            const settings = {
                companyName: document.getElementById('companyName').value,
                companyPhone: document.getElementById('companyPhone').value,
                companyEmail: document.getElementById('companyEmail').value,
                companyAddress: document.getElementById('companyAddress').value,
                taxRate: document.getElementById('taxRate').value,
                currency: document.getElementById('currency').value
            };
            localStorage.setItem('appSettings', JSON.stringify(settings));
            showMessageBox('Ù†Ø¬Ø§Ø­', 'ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
        }

        // Storage Management
        function saveToStorage() {
            localStorage.setItem('bookstorePOS', JSON.stringify(appData));
        }

        function loadFromStorage() {
            const stored = localStorage.getItem('bookstorePOS');
            if (stored) {
                appData = JSON.parse(stored);
            }
        }

        function exportBackup() {
            const backup = JSON.stringify(appData, null, 2);
            const blob = new Blob([backup], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'bookstore_backup_' + new Date().getTime() + '.json';
            link.click();
        }

        function importBackup() {
            document.getElementById('importFileInput').click();
        }

        function importBackupFile(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const imported = JSON.parse(e.target.result);
                    if (imported.products) {
                        appData = imported;
                        saveToStorage();
                        showMessageBox('Ù†Ø¬Ø§Ø­', 'ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
                        displayAllLists();
                    }
                } catch (error) {
                    showMessageBox('Ø®Ø·Ø£', 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯: ' + error.message);
                }
            };
            reader.readAsText(file);
        }

        function clearAllData() {
            if (confirm('Ù‡Ù„ ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡')) {
                appData = {
                    products: [],
                    customers: [],
                    employees: [],
                    sales: [],
                    returns: [],
                    wholesale: [],
                    expenses: [],
                    assets: [],
                    bankTransactions: [],
                    imports: [],
                    users: [],
                    invoices: [],
                    purchases: []
                };
                saveToStorage();
                displayAllLists();
                showMessageBox('ØªÙ…', 'ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
            }
        }

        function displayAllLists() {
            displayProductsList();
            displayCustomersList();
            displayEmployeesList();
            displayReturnsList();
            displayWholesaleList();
            displayUsersList();
            updateReports();
        }

        // File Operations
        function saveFile() {
            showMessageBox('ØªÙ…', 'ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
        }

        function openFile() {
            showMessageBox('Ù…Ø¹Ù„ÙˆÙ…Ø©', 'Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±');
        }

        function undo() {
            showMessageBox('Ù…Ø¹Ù„ÙˆÙ…Ø©', 'Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±');
        }

        function redo() {
            showMessageBox('Ù…Ø¹Ù„ÙˆÙ…Ø©', 'Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±');
        }

        function exitApp() {
            if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ØŸ')) {
                window.close();
            }
        }

        // Message Box
        function showMessageBox(title, message) {
            document.getElementById('messageTitle').textContent = title;
            document.getElementById('messageContent').textContent = message;
            document.getElementById('messageBox').classList.add('show');
        }

        function closeMessageBox() {
            document.getElementById('messageBox').classList.remove('show');
        }
    </script>
</body>
</html>
